<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>NA â€¢ CrossTalkeR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>




<meta property="og:title" content="NA" />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->




  

  

  </head>

  <body data-spy="scroll" data-target="#toc">
    

    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">CrossTalkeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="articles/CrossTalkeR.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/html/Output_Samples.html">Single Phenotype Report</a>
    </li>
    <li>
      <a href="articles/html/Output_Samples1.html">Comparative Phenotype Report</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/CostaLab/CrossTalkeR/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>NA</h1>
    </div>

<div id="cellphonedb-cookbook" class="section level2">
<h2 class="hasAnchor">
<a href="#cellphonedb-cookbook" class="anchor"></a>CellPhoneDB CookBook</h2>
<p><em>by James Nagai</em></p>
<div id="0--installation" class="section level3">
<h3 class="hasAnchor">
<a href="#0--installation" class="anchor"></a>0- Installation</h3>
<p><code>pip3 install cellphonedb</code></p>
</div>
<div id="1---step-extract-data-from-seurat-object" class="section level3">
<h3 class="hasAnchor">
<a href="#1---step-extract-data-from-seurat-object" class="anchor"></a>1 - Step Extract data from Seurat Object</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">require</span>(EWCE)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">require</span>(tibble)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">require</span>(biomaRt)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">require</span>(tidyr)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">require</span>(dplyr)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co"># Basic function to convert mouse to human gene names</span></a>
<a class="sourceLine" id="cb1-7" title="7">data_ &lt;-<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">'path_to_data'</span>)</a>
<a class="sourceLine" id="cb1-8" title="8">alldata &lt;-<span class="st"> </span><span class="kw">NormalizeData</span>(alldata, <span class="dt">normalization.method =</span> <span class="st">"LogNormalize"</span>, <span class="dt">scale.factor =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb1-9" title="9">allgenes &lt;-<span class="st"> </span><span class="kw">rownames</span>(alldata)</a>
<a class="sourceLine" id="cb1-10" title="10">matrix1 &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(alldata<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>data)</a>
<a class="sourceLine" id="cb1-11" title="11">matrix1 &lt;-<span class="st"> </span>matrix1[<span class="kw">rowSums</span>(matrix1[,<span class="dv">2</span><span class="op">:</span><span class="kw">dim</span>(matrix1)[<span class="dv">2</span>]])<span class="op">!=</span><span class="dv">0</span>,]</a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="co">### If you are using a mouse data, then its needed to convert the gene names to human orthologs</span></a>
<a class="sourceLine" id="cb1-14" title="14">human =<span class="st"> </span><span class="kw">useEnsembl</span>(<span class="st">"ensembl"</span>, <span class="dt">dataset =</span> <span class="st">"hsapiens_gene_ensembl"</span>)</a>
<a class="sourceLine" id="cb1-15" title="15">mouse =<span class="st"> </span><span class="kw">useEnsembl</span>(<span class="st">"ensembl"</span>, <span class="dt">dataset =</span> <span class="st">"mmusculus_gene_ensembl"</span>)</a>
<a class="sourceLine" id="cb1-16" title="16">genesV2 =<span class="st"> </span><span class="kw">getLDS</span>(<span class="dt">attributes =</span> <span class="kw">c</span>(<span class="st">"mgi_symbol"</span>), <span class="dt">filters =</span> <span class="st">"mgi_symbol"</span>, <span class="dt">values =</span> <span class="kw">rownames</span>(alldata<span class="op">@</span>assays<span class="op">$</span>RNA<span class="op">@</span>data) , <span class="dt">mart =</span> mouse, <span class="dt">attributesL =</span> <span class="kw">c</span>(<span class="st">"hgnc_symbol"</span>,<span class="st">"hgnc_id"</span>,<span class="st">'ensembl_gene_id'</span>), <span class="dt">martL =</span> human, <span class="dt">uniqueRows=</span>T)</a>
<a class="sourceLine" id="cb1-17" title="17"><span class="kw">print</span>(<span class="kw">head</span>(genesV2))</a>
<a class="sourceLine" id="cb1-18" title="18">matrix1 &lt;-<span class="st"> </span>matrix1[<span class="kw">match</span>(genesV2<span class="op">$</span>MGI.symbol,<span class="kw">rownames</span>(alldata),<span class="dt">nomatch=</span>F),]</a>
<a class="sourceLine" id="cb1-19" title="19">matrix1<span class="op">$</span>gene &lt;-<span class="st"> </span>genesV2<span class="op">$</span>Gene.stable.ID</a>
<a class="sourceLine" id="cb1-20" title="20"><span class="co">#rownames(matrix1) &lt;-  genesV2$Gene.stable.ID</span></a>
<a class="sourceLine" id="cb1-21" title="21"></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="co">### Subseting the matrix</span></a>
<a class="sourceLine" id="cb1-23" title="23">s1 &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">'state1'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>cond)</a>
<a class="sourceLine" id="cb1-24" title="24">s2 &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">'state2'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>cond)</a>
<a class="sourceLine" id="cb1-25" title="25">s1[<span class="kw">match</span>(<span class="st">'gene'</span>,<span class="kw">colnames</span>(matrix1))] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1-26" title="26">s2[<span class="kw">match</span>(<span class="st">'gene'</span>,<span class="kw">colnames</span>(matrix1))] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1-27" title="27"></a>
<a class="sourceLine" id="cb1-28" title="28"><span class="co">## Checking the dimensions</span></a>
<a class="sourceLine" id="cb1-29" title="29"><span class="kw">print</span>(<span class="kw">dim</span>(matrix1[,s1]))</a>
<a class="sourceLine" id="cb1-30" title="30"><span class="kw">print</span>(<span class="kw">dim</span>(matrix1[,s2]))</a>
<a class="sourceLine" id="cb1-31" title="31"></a>
<a class="sourceLine" id="cb1-32" title="32"></a>
<a class="sourceLine" id="cb1-33" title="33"><span class="co">## If the cluster names are categorical, you will need to convert it to numerical</span></a>
<a class="sourceLine" id="cb1-34" title="34">alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type &lt;-<span class="st"> </span><span class="kw">as.factor</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type)</a>
<a class="sourceLine" id="cb1-35" title="35"><span class="kw">print</span>(<span class="kw">levels</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type))</a>
<a class="sourceLine" id="cb1-36" title="36"><span class="kw">levels</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type) &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type))</a>
<a class="sourceLine" id="cb1-37" title="37"><span class="kw">print</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">levels</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type)))</a>
<a class="sourceLine" id="cb1-38" title="38">alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type)</a>
<a class="sourceLine" id="cb1-39" title="39"></a>
<a class="sourceLine" id="cb1-40" title="40"></a>
<a class="sourceLine" id="cb1-41" title="41"><span class="kw">write.table</span>(matrix1[,s1], <span class="st">'s1_filtered_hcount.csv'</span>,<span class="dt">row.names=</span>T,<span class="dt">sep=</span><span class="st">','</span>)</a>
<a class="sourceLine" id="cb1-42" title="42"><span class="kw">write.table</span>(matrix1[,s2], <span class="st">'s2_filtered_hcount.csv'</span>,<span class="dt">row.names=</span>T,<span class="dt">sep=</span><span class="st">','</span>)</a>
<a class="sourceLine" id="cb1-43" title="43">metadata &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cells=</span><span class="kw">rownames</span>(alldata<span class="op">@</span>meta.data[<span class="kw">grepl</span>(<span class="st">'state1'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>stim),]),<span class="dt">cluster=</span>alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type[<span class="kw">grepl</span>(<span class="st">'state1'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>stim)])</a>
<a class="sourceLine" id="cb1-44" title="44">metadata_s2 &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">cells=</span><span class="kw">rownames</span>(alldata<span class="op">@</span>meta.data[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">'state1'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>stim),]),<span class="dt">cluster=</span>alldata<span class="op">@</span>meta.data<span class="op">$</span>sub_cell_type[<span class="op">!</span><span class="kw">grepl</span>(<span class="st">'state1'</span>,alldata<span class="op">@</span>meta.data<span class="op">$</span>stim)]) <span class="co">## Just negate grepl('state1',alldata@meta.data$stim),]</span></a>
<a class="sourceLine" id="cb1-45" title="45"><span class="kw">print</span>(<span class="st">'Writing Metadata'</span>)</a>
<a class="sourceLine" id="cb1-46" title="46"><span class="kw">write.csv</span>(metadata, <span class="st">'s1_filtered_meta.csv'</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1-47" title="47"><span class="kw">write.csv</span>(metadata_tac, <span class="st">'s2_filtered_meta.csv'</span>, <span class="dt">row.names=</span><span class="ot">FALSE</span>)<span class="st">```</span></a></code></pre></div>
<p><strong>Note that the gene ID needs to be unique, you will need to use an approach to combine multiple mapped orthologs (sum, max or bitwiseor )</strong></p>
</div>
<div id="run-cellphonedb" class="section level3">
<h3 class="hasAnchor">
<a href="#run-cellphonedb" class="anchor"></a>Run CellPhoneDB</h3>
<p>** The parameters list is available at https://github.com/Teichlab/cellphonedb</p>
<div id="ensembl-based-id" class="section level4">
<h4 class="hasAnchor">
<a href="#ensembl-based-id" class="anchor"></a>Ensembl based ID</h4>
<pre><code>#! /bin/bash
mkdir s1 s2  # creating the output folders

cellphonedb method statistical_analysis s1_filtered_meta.csv  s1_filtered_hcount.csv  --threads 30 --output-path s1/

cellphonedb method statistical_analysis s2_filtered_meta.csv  s2_filtered_hcount.csv  --threads 30 --output-path s2/
</code></pre>
</div>
<div id="hugo-based-id" class="section level4">
<h4 class="hasAnchor">
<a href="#hugo-based-id" class="anchor"></a>HUGO based ID</h4>
<pre><code>#! /bin/bash
mkdir s1 s2  # creating the output folders

cellphonedb method statistical_analysis s1_filtered_meta.csv --counts-data hgnc_symbol s1_filtered_hcount.csv  --threads 30 --output-path s1/

cellphonedb method statistical_analysis s2_filtered_meta.csv --counts-data hgnc_symbol s2_filtered_hcount.csv  --threads 30 --output-path s2/
</code></pre>
</div>
</div>
<div id="extracting-lr" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-lr" class="anchor"></a>Extracting LR</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">def</span> correct_lr(data):</a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="co">'''</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">    Invert the RL to LR and R1R2 to r2&gt;r1</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">    '''</span></a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="im">import</span> pandas <span class="im">as</span> pd</a>
<a class="sourceLine" id="cb4-6" title="6">    <span class="kw">def</span> swap(a,b): <span class="cf">return</span> b,a</a>
<a class="sourceLine" id="cb4-7" title="7">    data <span class="op">=</span> data.to_dict(<span class="st">'index'</span>)</a>
<a class="sourceLine" id="cb4-8" title="8">    <span class="cf">for</span> k,v <span class="kw">in</span> data.items():</a>
<a class="sourceLine" id="cb4-9" title="9">        <span class="cf">if</span> v[<span class="st">'isReceptor_fst'</span>] <span class="kw">and</span> v[<span class="st">'isReceptor_scn'</span>]:</a>
<a class="sourceLine" id="cb4-10" title="10">            v[<span class="st">'isReceptor_fst'</span>],v[<span class="st">'isReceptor_scn'</span>] <span class="op">=</span> swap(v[<span class="st">'isReceptor_fst'</span>],v[<span class="st">'isReceptor_scn'</span>])</a>
<a class="sourceLine" id="cb4-11" title="11">            v[<span class="st">'Ligand'</span>],v[<span class="st">'Receptor'</span>] <span class="op">=</span> swap(v[<span class="st">'Ligand'</span>],v[<span class="st">'Receptor'</span>])</a>
<a class="sourceLine" id="cb4-12" title="12">            v[<span class="st">'Ligand.Cluster'</span>],v[<span class="st">'Receptor.Cluster'</span>] <span class="op">=</span> swap(v[<span class="st">'Ligand.Cluster'</span>],v[<span class="st">'Receptor.Cluster'</span>])</a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="cf">elif</span> v[<span class="st">'isReceptor_fst'</span>] <span class="kw">and</span> <span class="kw">not</span> v[<span class="st">'isReceptor_scn'</span>]:</a>
<a class="sourceLine" id="cb4-14" title="14">            v[<span class="st">'isReceptor_fst'</span>],v[<span class="st">'isReceptor_scn'</span>] <span class="op">=</span> swap(v[<span class="st">'isReceptor_fst'</span>],v[<span class="st">'isReceptor_scn'</span>])</a>
<a class="sourceLine" id="cb4-15" title="15">            v[<span class="st">'Ligand'</span>],v[<span class="st">'Receptor'</span>] <span class="op">=</span> swap(v[<span class="st">'Ligand'</span>],v[<span class="st">'Receptor'</span>])</a>
<a class="sourceLine" id="cb4-16" title="16">            v[<span class="st">'Ligand.Cluster'</span>],v[<span class="st">'Receptor.Cluster'</span>] <span class="op">=</span> swap(v[<span class="st">'Ligand.Cluster'</span>],v[<span class="st">'Receptor.Cluster'</span>])</a>
<a class="sourceLine" id="cb4-17" title="17">    res_df <span class="op">=</span> pd.DataFrame.from_dict(data,orient<span class="op">=</span><span class="st">'index'</span>)</a>
<a class="sourceLine" id="cb4-18" title="18">    <span class="cf">return</span> (res_df)</a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw">def</span> cpdb2df(data,clsmapping):</a>
<a class="sourceLine" id="cb4-20" title="20">    data <span class="op">=</span> data.fillna(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-21" title="21">    df_data <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb4-22" title="22">    df_data[<span class="st">'Ligand'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-23" title="23">    df_data[<span class="st">'Receptor'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-24" title="24">    df_data[<span class="st">'Ligand.Cluster'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-25" title="25">    df_data[<span class="st">'Receptor.Cluster'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-26" title="26">    df_data[<span class="st">'isReceptor_fst'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-27" title="27">    df_data[<span class="st">'isReceptor_scn'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-28" title="28">    df_data[<span class="st">'MeanLR'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-29" title="29">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(data.shape[<span class="dv">0</span>]):</a>
<a class="sourceLine" id="cb4-30" title="30">        pair <span class="op">=</span> <span class="bu">list</span>(data[<span class="st">'interacting_pair'</span>])[i].split(<span class="st">'_'</span>)</a>
<a class="sourceLine" id="cb4-31" title="31">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(data.iloc[:,<span class="dv">12</span>:].shape[<span class="dv">1</span>]):</a>
<a class="sourceLine" id="cb4-32" title="32">            c_pair <span class="op">=</span> <span class="bu">list</span>(data.columns)[j<span class="op">+</span><span class="dv">12</span>].split(<span class="st">'|'</span>)</a>
<a class="sourceLine" id="cb4-33" title="33">            <span class="cf">if</span> <span class="bu">float</span>(data.iloc[i,j<span class="op">+</span><span class="dv">12</span>]) <span class="op">!=</span><span class="fl">0.0</span>:</a>
<a class="sourceLine" id="cb4-34" title="34">                df_data[<span class="st">'Ligand'</span>].append(pair[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb4-35" title="35">                df_data[<span class="st">'Receptor'</span>].append(pair[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-36" title="36">                df_data[<span class="st">'Ligand.Cluster'</span>].append(clsmapping[c_pair[<span class="dv">0</span>]])</a>
<a class="sourceLine" id="cb4-37" title="37">                df_data[<span class="st">'Receptor.Cluster'</span>].append(clsmapping[c_pair[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb4-38" title="38">                df_data[<span class="st">'isReceptor_fst'</span>].append(<span class="bu">list</span>(data[<span class="st">'receptor_a'</span>])[i])</a>
<a class="sourceLine" id="cb4-39" title="39">                df_data[<span class="st">'isReceptor_scn'</span>].append(<span class="bu">list</span>(data[<span class="st">'receptor_b'</span>])[i])</a>
<a class="sourceLine" id="cb4-40" title="40">                df_data[<span class="st">'MeanLR'</span>].append(data.iloc[i,j<span class="op">+</span><span class="dv">12</span>])</a>
<a class="sourceLine" id="cb4-41" title="41">    data_final <span class="op">=</span> pd.DataFrame.from_dict(df_data)</a>
<a class="sourceLine" id="cb4-42" title="42">    <span class="cf">return</span>(data_final)</a>
<a class="sourceLine" id="cb4-43" title="43"></a>
<a class="sourceLine" id="cb4-44" title="44"><span class="kw">def</span> cpdb2df_nocls(data):</a>
<a class="sourceLine" id="cb4-45" title="45">    <span class="co">'''</span></a>
<a class="sourceLine" id="cb4-46" title="46"><span class="co">        When the cluster name is used on CPDB</span></a>
<a class="sourceLine" id="cb4-47" title="47"><span class="co">    '''</span></a>
<a class="sourceLine" id="cb4-48" title="48">    data <span class="op">=</span> data.fillna(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb4-49" title="49">    df_data <span class="op">=</span> {}</a>
<a class="sourceLine" id="cb4-50" title="50">    df_data[<span class="st">'Ligand'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-51" title="51">    df_data[<span class="st">'Receptor'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-52" title="52">    df_data[<span class="st">'Ligand.Cluster'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-53" title="53">    df_data[<span class="st">'Receptor.Cluster'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-54" title="54">    df_data[<span class="st">'isReceptor_fst'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-55" title="55">    df_data[<span class="st">'isReceptor_scn'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-56" title="56">    df_data[<span class="st">'MeanLR'</span>] <span class="op">=</span> []</a>
<a class="sourceLine" id="cb4-57" title="57">    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(data.shape[<span class="dv">0</span>]):</a>
<a class="sourceLine" id="cb4-58" title="58">        pair <span class="op">=</span> <span class="bu">list</span>(data[<span class="st">'interacting_pair'</span>])[i].split(<span class="st">'_'</span>)</a>
<a class="sourceLine" id="cb4-59" title="59">        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(data.iloc[:,<span class="dv">12</span>:].shape[<span class="dv">1</span>]):</a>
<a class="sourceLine" id="cb4-60" title="60">            c_pair <span class="op">=</span> <span class="bu">list</span>(data.columns)[j<span class="op">+</span><span class="dv">12</span>].split(<span class="st">'|'</span>)</a>
<a class="sourceLine" id="cb4-61" title="61">            <span class="cf">if</span> <span class="bu">float</span>(data.iloc[i,j<span class="op">+</span><span class="dv">12</span>]) <span class="op">!=</span><span class="fl">0.0</span>:</a>
<a class="sourceLine" id="cb4-62" title="62">                df_data[<span class="st">'Ligand'</span>].append(pair[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb4-63" title="63">                df_data[<span class="st">'Receptor'</span>].append(pair[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-64" title="64">                df_data[<span class="st">'Ligand.Cluster'</span>].append(c_pair[<span class="dv">0</span>])</a>
<a class="sourceLine" id="cb4-65" title="65">                df_data[<span class="st">'Receptor.Cluster'</span>].append(c_pair[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-66" title="66">                df_data[<span class="st">'isReceptor_fst'</span>].append(<span class="bu">list</span>(data[<span class="st">'receptor_a'</span>])[i])</a>
<a class="sourceLine" id="cb4-67" title="67">                df_data[<span class="st">'isReceptor_scn'</span>].append(<span class="bu">list</span>(data[<span class="st">'receptor_b'</span>])[i])</a>
<a class="sourceLine" id="cb4-68" title="68">                df_data[<span class="st">'MeanLR'</span>].append(data.iloc[i,j<span class="op">+</span><span class="dv">12</span>])</a>
<a class="sourceLine" id="cb4-69" title="69">    data_final <span class="op">=</span> pd.DataFrame.from_dict(df_data)</a>
<a class="sourceLine" id="cb4-70" title="70">    <span class="cf">return</span>(data_final)</a>
<a class="sourceLine" id="cb4-71" title="71"></a>
<a class="sourceLine" id="cb4-72" title="72">s1 <span class="op">=</span> pd.read_csv(<span class="st">'./s1/significant_means.txt'</span>,sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb4-73" title="73">s2 <span class="op">=</span> pd.read_csv(<span class="st">'./s2/ significant_means.txt'</span>,sep<span class="op">=</span><span class="st">'</span><span class="ch">\t</span><span class="st">'</span>)</a>
<a class="sourceLine" id="cb4-74" title="74"><span class="co">#dict with the mapping</span></a>
<a class="sourceLine" id="cb4-75" title="75">num_to_clust <span class="op">=</span> {<span class="st">'1'</span>:<span class="st">'Cluters 1'</span>,</a>
<a class="sourceLine" id="cb4-76" title="76">                <span class="st">'2'</span>:<span class="st">'Cluters 2'</span>,</a>
<a class="sourceLine" id="cb4-77" title="77">                <span class="st">'3'</span>:<span class="st">'Cluters 3'</span>,</a>
<a class="sourceLine" id="cb4-78" title="78">                <span class="st">'4'</span>:<span class="st">'Cluters 4'</span>,</a>
<a class="sourceLine" id="cb4-79" title="79">                <span class="st">'5'</span>:<span class="st">'Cluters 5'</span>}</a>
<a class="sourceLine" id="cb4-80" title="80"></a>
<a class="sourceLine" id="cb4-81" title="81">s1_filtered <span class="op">=</span> cpdb2df(s1,num_to_clust)</a>
<a class="sourceLine" id="cb4-82" title="82">s2_filtered <span class="op">=</span> cpdb2df(s2,num_to_clust)</a>
<a class="sourceLine" id="cb4-83" title="83">s1_filtered <span class="op">=</span> correct_lr(s1_filtered)</a>
<a class="sourceLine" id="cb4-84" title="84">s2_filtered <span class="op">=</span> correct_lr(s2_filtered)</a>
<a class="sourceLine" id="cb4-85" title="85"></a>
<a class="sourceLine" id="cb4-86" title="86">s1_filtered.to_csv(<span class="st">'s1_filtered_corrected.csv'</span>)</a>
<a class="sourceLine" id="cb4-87" title="87">s2_filtered.to_csv(<span class="st">'s2_filtered_corrected.csv'</span>)</a></code></pre></div>
</div>
<div id="crosstalker" class="section level3">
<h3 class="hasAnchor">
<a href="#crosstalker" class="anchor"></a>CrossTalkeR</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(<span class="st">'CrossTalkeR'</span>)</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co"># the method always consider the first path as control: the multiple control case will be handle soon</span></a>
<a class="sourceLine" id="cb5-4" title="4">paths &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'CTR'</span> =<span class="st"> 's1_filtered_corrected.csv'</span>,</a>
<a class="sourceLine" id="cb5-5" title="5">           <span class="st">'EXP'</span> =<span class="st"> 's1_filtered_corrected.csv'</span>,</a>
<a class="sourceLine" id="cb5-6" title="6">           <span class="st">'EXP1'</span> =<span class="st"> 's1_filtered_corrected.csv'</span>,)</a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co"># Selected gene list     </span></a>
<a class="sourceLine" id="cb5-8" title="8">genes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">'TGFB1'</span>, <span class="st">'PF4'</span>)</a>
<a class="sourceLine" id="cb5-9" title="9"></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co"># Generating the report and the object</span></a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">data &lt;-<span class="st"> </span><span class="kw">generate_report</span>(<span class="dt">paths=</span>paths, <span class="co"># paths list</span></a>
<a class="sourceLine" id="cb5-13" title="13">                        <span class="dt">selected_genes=</span>genes, <span class="co"># Selected list</span></a>
<a class="sourceLine" id="cb5-14" title="14">                        <span class="dt">output=</span><span class="st">'/home/nagai/Documents/'</span>, <span class="co"># output path</span></a>
<a class="sourceLine" id="cb5-15" title="15">                        <span class="dt">threshold =</span> <span class="dv">0</span>, <span class="co"># threshold of prune edges 0=keep all</span></a>
<a class="sourceLine" id="cb5-16" title="16">                        <span class="dt">out_file=</span><span class="st">'All_Nils.html'</span> report name</a>
<a class="sourceLine" id="cb5-17" title="17">                        )</a></code></pre></div>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>

</div>



      <footer>
      <div class="copyright">
  <p><p>Developed by James Shiniti Nagai, Nils LeimkÃ¼hler, Michael T. Schaub, Rebekka Schneider, Ivan Costa Gesteira.</p></p>
</div>

<div class="pkgdown">
  <p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.6.1.9001.</p></p>
</div>

      </footer>
   </div>

  


  

  </body>
</html>


