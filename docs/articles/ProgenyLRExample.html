<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Ligand-Receptor Pathway Enrichment with Progeny - Bone Marrow Fibrosis in Human • CrossTalkeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Ligand-Receptor Pathway Enrichment with Progeny - Bone Marrow Fibrosis in Human">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-black" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CrossTalkeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/CrossTalkeR.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/CrossTalker_basicusage.html">CrossTalkeR 101</a></li>
    <li><a class="dropdown-item" href="../articles/HumanFibrosis.html">Example: Bone Marrow Fibrosis in Human (Leimkuhler et. al., 2021)</a></li>
    <li><a class="dropdown-item" href="../articles/MyocardialInfarction.html">Example: Heart Myocardial Infarcition in Human (Kuppe et. al., 2022)</a></li>
    <li><a class="dropdown-item" href="../articles/LR2TF_analysis.html">Intracellular Communication Analysis Bone Marrow Fibrosis in Human</a></li>
    <li><a class="dropdown-item" href="../articles/run_liana.html">Ligand-Receptor Inference with Liana</a></li>
    <li><a class="dropdown-item" href="../articles/ProgenyLRExample.html">Ligand-Receptor Pathway Enrichment with Progeny - Bone Marrow Fibrosis in Human</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/Install.html">Install</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CostaLab/CrossTalkeR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Ligand-Receptor Pathway Enrichment with Progeny - Bone Marrow Fibrosis in Human</h1>
                        <h4 data-toc-skip class="author">Vanessa
Klöker</h4>
            <address class="author_afil">
      Institute for Computational Genomics, Faculty of Medicine, RWTH
Aachen University, Aachen, 52074
Germany<br><h4 data-toc-skip class="author">James
S. Nagai</h4>
            <address class="author_afil">
      Institute for Computational Genomics, Faculty of Medicine, RWTH
Aachen University, Aachen, 52074
Germany<br><h4 data-toc-skip class="author">Ivan
G. Costa</h4>
            <address class="author_afil">
      Institute for Computational Genomics, Faculty of Medicine, RWTH
Aachen University, Aachen, 52074 Germany<br><small class="dont-index">Source: <a href="https://github.com/CostaLab/CrossTalkeR/blob/HEAD/vignettes/ProgenyLRExample.rmd" class="external-link"><code>vignettes/ProgenyLRExample.rmd</code></a></small>
      <div class="d-none name"><code>ProgenyLRExample.rmd</code></div>
    </address>
</address>
</address>
</div>

    
    
<div class="section level2">
<h2 id="ligand-receptor-pathway-enrichment-with-progeny---example">Ligand-Receptor Pathway Enrichment with Progeny - Example<a class="anchor" aria-label="anchor" href="#ligand-receptor-pathway-enrichment-with-progeny---example"></a>
</h2>
<p>The liana+ Python documentation includes an example of performing
pathway enrichment on ligand-receptor interactions derived from tensor
cell2cell analysis (<a href="https://liana-py.readthedocs.io/en/latest/notebooks/liana_c2c.html" class="external-link">liana+
Tutorial</a>). Here, we apply this downstream pathway enrichment
approach to CrossTalkeR results using human bone marrow example data (<a href="https://costalab.github.io/CrossTalkeR/articles/HumanFibrosis.html" class="external-link">Tutorial</a>),
focusing specifically on ligand-receptor interactions from mesenchymal
stem cells (MSCs) to fibroblasts.</p>
<div class="section level3">
<h3 id="filter-crosstalker-results-in-r">Filter CrossTalkeR Results (in R)<a class="anchor" aria-label="anchor" href="#filter-crosstalker-results-in-r"></a>
</h3>
<p>We begin by loading the CrossTalkeR object and extracting the table
of ligand-receptor interactions obtained from the comparison analysis of
control and disease conditions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CostaLab/CrossTalkeR" class="external-link">CrossTalkeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">CrossTalkeR_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"LR_data_final.Rds"</span><span class="op">)</span></span>
<span><span class="va">EXP_x_CTR_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">CrossTalkeR_results</span><span class="op">@</span><span class="va">tables</span><span class="op">$</span><span class="va">EXP_x_CTR</span><span class="op">)</span></span></code></pre></div>
<p>To facilitate the use of liana+ functions, we reformat and filter the
table, resulting in a structured dataset with ligand-receptor pairs in
the first and their corresponding LRScore in the second column.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interactions_of_interest</span> <span class="op">&lt;-</span> <span class="va">EXP_x_CTR_table</span><span class="op">[</span><span class="va">EXP_x_CTR_table</span><span class="op">$</span><span class="va">source</span> <span class="op">==</span> <span class="st">"MSC"</span> <span class="op">&amp;</span> <span class="va">EXP_x_CTR_table</span><span class="op">$</span><span class="va">target</span> <span class="op">==</span> <span class="st">"MSC"</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">interactions_of_interest</span><span class="op">$</span><span class="va">genepair</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span></span>
<span>        <span class="st">"\\|L"</span>,</span>
<span>        <span class="st">""</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">interactions_of_interest</span><span class="op">$</span><span class="va">gene_A</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span></span>
<span>        <span class="st">"\\|R"</span>,</span>
<span>        <span class="st">""</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">interactions_of_interest</span><span class="op">$</span><span class="va">gene_B</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"@"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">interactions_of_interest</span> <span class="op">&lt;-</span> <span class="va">interactions_of_interest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>LRScore <span class="op">=</span> <span class="va">interactions_of_interest</span><span class="op">$</span><span class="va">LRScore</span>, row.names <span class="op">=</span> <span class="va">interactions_of_interest</span><span class="op">$</span><span class="va">genepair</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">interactions_of_interest</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"MSC_Megakaryocyte_LR_interactions.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Due to certain functionalities being unavailable in the R version of
liana, the subsequent analyses are conducted in Python.</p>
</div>
<div class="section level3">
<h3 id="enrichment-analysis-with-progeny-and-decoupler-in-python">Enrichment Analysis with Progeny and decoupleR (in Python)<a class="anchor" aria-label="anchor" href="#enrichment-analysis-with-progeny-and-decoupler-in-python"></a>
</h3>
<p>We start with loading all necessary Python libraries.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">import</span> liana <span class="im">as</span> li</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="im">import</span> omnipath <span class="im">as</span> op</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="im">import</span> decoupler <span class="im">as</span> dc</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p>To perform pathway enrichment analysis, we require a pathway database
containing gene sets. For this purpose, we utilize the Progeny Pathway
database, setting the top argument to 20,000 to load the complete
dataset.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Load Progeny Pathway Database</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>progeny <span class="op">=</span> dc.get_progeny(organism<span class="op">=</span><span class="st">'human'</span>, top<span class="op">=</span><span class="dv">20000</span>)</span></code></pre></div>
<p>Since the analysis considers ligand-receptor pairs rather than
individual genes, we must first map these interactions to relevant
pathways. To achieve this, we load the Consensus database from liana,
which was also used for ligand-receptor interaction inference in this
data. A dedicated function then assigns ligand-receptor pairs to their
respective pathways.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Load Ligand-Receptor Pairs from liana Consensus Database</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>lr_pairs <span class="op">=</span> li.resource.select_resource(<span class="st">'consensus'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="co"># Assign Ligand-Receptor Pairs to Progeny Pathways</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>lr_progeny <span class="op">=</span> li.rs.generate_lr_geneset(lr_pairs, progeny, lr_sep<span class="op">=</span><span class="st">"@"</span>)</span></code></pre></div>
<p>Next, we incorporate the ligand-receptor interactions of interest,
extracted from the CrossTalkeR results, and conduct the enrichment
analysis using the decoupler ULM method along with the ligand-receptor
pathway mapping. This analysis yields two data frames: one containing
the enrichment estimation values and another reporting the corresponding
p-values, indicating statistical significance.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># Load Ligand-Receptor Interactions for Enrichment Analysis</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>lr_interactions <span class="op">=</span> pd.read_csv(<span class="st">"MSC_MSC_LR.csv"</span>, index_col<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co"># Run Enrichment Analysis with decoupleR ULM Method</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>estimate, pvals <span class="op">=</span> dc.run_ulm(lr_interactions.transpose(), lr_progeny, source<span class="op">=</span><span class="st">"source"</span>, target<span class="op">=</span><span class="st">"interaction"</span>, use_raw<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="visualize-results-in-python">Visualize Results (in Python)<a class="anchor" aria-label="anchor" href="#visualize-results-in-python"></a>
</h3>
<p>To visualize the results, we generate a heatmap using seaborn. To
highlight pathways with significant enrichment estimations, we first
create an annotation data frame, which is then incorporated into the
heatmap visualization.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Mapping to Vizualize P-Value Significance Levels</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="kw">def</span> p_value_to_asterisks(p):</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>    <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.001</span>:</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'***'</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>    <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'**'</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>    <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">'*'</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">' '</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>pval_mapping <span class="op">=</span> pvals.applymap(p_value_to_asterisks)</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co"># Vizualize Enrichment Results with Seaborn Clustermap</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>sns.clustermap(estimate.T, annot<span class="op">=</span>pval_mapping.T, fmt<span class="op">=</span><span class="st">''</span>, row_cluster<span class="op">=</span><span class="va">False</span>, figsize<span class="op">=</span>(<span class="dv">7</span>, <span class="dv">2</span>), cmap<span class="op">=</span><span class="st">"vlag"</span>)</span></code></pre></div>
<figure class="figure" style="display: table; margin: auto; height: 60%; width: 60%;"><img src="Progeny_images%2FMSC_Fibroblast_enrichment.png" alt=""><figcaption class="figcaption" style="display: table-caption; caption-side: bottom;"></figcaption></figure><p><br><br></p>
<p>The heatmap shows, that signaling in the WNT pathway is significantly
enriched in the ligand-receptor interactions between MSCs and
fibroblasts. Further the result indicates that this pathway is up in the
disease condition. On the other hand MAPK and VEGF pathways are
predicted to be down in the disease condition.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vanessa Kloeker, James Shiniti Nagai, Nils Leimkühler, Michael T. Schaub, Rebekka Schneider, Ivan Costa Gesteira.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
