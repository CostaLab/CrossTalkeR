<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run liana for Ligand Receptor Interaction Prediction • CrossTalkeR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Run liana for Ligand Receptor Interaction Prediction">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-black" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CrossTalkeR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/CrossTalkeR.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-tutorials" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Tutorials</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-tutorials">
<li><a class="dropdown-item" href="../articles/CrossTalker_basicusage.html">CrossTalkeR 101</a></li>
    <li><a class="dropdown-item" href="../articles/HumanFibrosis.html">Example: Bone Marrow Fibrosis (Leimkuhler et. al., 2021)</a></li>
    <li><a class="dropdown-item" href="../articles/LR2TF_analysis.html">Transcription Factor Activity Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/MyocardialInfarction.html">Example: Heart Myocardial Infarcition (Kuppe et. al., 2022)</a></li>
    <li><a class="dropdown-item" href="../articles/run_liana.html">Ligand-Receptor Inference with Liana</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/Install.html">Install</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/CostaLab/CrossTalkeR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="run_liana_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run liana for Ligand Receptor Interaction Prediction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CostaLab/CrossTalkeR/blob/HEAD/vignettes/run_liana.rmd" class="external-link"><code>vignettes/run_liana.rmd</code></a></small>
      <div class="d-none name"><code>run_liana.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="run-liana-for-ligand-receptor-interaction-prediction-in-python">Run liana for ligand-receptor interaction prediction in Python<a class="anchor" aria-label="anchor" href="#run-liana-for-ligand-receptor-interaction-prediction-in-python"></a>
</h2>
<p>For the prediction of ligand-receptor interactions, we use the python version of the package <a href="https://liana-py.readthedocs.io/en/latest/" class="external-link">liana</a>. This package provides different methods and databases for the analysis of intercellular interactions based on scRNA-seq data in the AnnData format. In this Tutorial, we describe our recommendation for using the liana package in python.</p>
<div class="section level3">
<h3 id="import-necessary-libraries">Import necessary libraries<a class="anchor" aria-label="anchor" href="#import-necessary-libraries"></a>
</h3>
<p>First of all, the libraries necessary for using liana must be loaded:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a><span class="im">import</span> scanpy <span class="im">as</span> sc</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a><span class="im">import</span> liana <span class="im">as</span> li</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a><span class="im">import</span> os</span></code></pre></div>
<p>We assume here that the necessary libraries are already installed.</p>
</div>
<div class="section level3">
<h3 id="load-scrna-seq-data">Load scRNA-seq data<a class="anchor" aria-label="anchor" href="#load-scrna-seq-data"></a>
</h3>
<p>The last step before perfoming the analysis is to load the AnnData object with the scRNA-seq data</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true"></a>data <span class="op">=</span> sc.read_h5ad(<span class="st">"/path/to/AnnData/file.h5ad"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true"></a>data.raw <span class="op">=</span> data</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="execution-of-ligand-receptor-interaction-analysis">Execution of ligand-receptor interaction analysis<a class="anchor" aria-label="anchor" href="#execution-of-ligand-receptor-interaction-analysis"></a>
</h3>
<p>As mentioned at the beginning, there are different methods and databases implemented in the liana package. We recommend using the CellphoneDB analysis in combination with the consensus database with intercellular interactions. Note that metadata fields for the available sample/conditions (field_with_condition) and for the cell annotations (field_with_cell_annotation) are still specified by the user.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">set</span>(data.obs[<span class="st">'field_with_condition'</span>]):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a>    <span class="bu">print</span>(i)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>    lr<span class="op">=</span>li.method.cellphonedb(data[data.obs[<span class="st">'field_with_condition'</span>]<span class="op">==</span>i],</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a>                          groupby<span class="op">=</span><span class="st">'field_with_cell_annotation'</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a>                          expr_prop<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>                          verbose<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>                          resource_name<span class="op">=</span><span class="st">'consensus'</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>                          inplace<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a>    lr.to_csv(<span class="ss">f"</span><span class="sc">{i}</span><span class="ss">_lr_liana_consensus_unfiltered.csv"</span>)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="filtering-and-formatting-of-the-results">Filtering and formatting of the results<a class="anchor" aria-label="anchor" href="#filtering-and-formatting-of-the-results"></a>
</h3>
<p>Finally, the result tables are filtered by the CellphoneDB p-value (here in the example p-val &lt; 0.05) and converted into the CrossTalkeR input format. By default, the interaction table used for CrossTalkeR should contain the columns “source”, “target”, “type_gene_A”, “gene_A”, “type_gene_B”, “gene_B” and “MeanLR”.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true"></a>data <span class="op">=</span> {}</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true"></a><span class="cf">for</span> i <span class="kw">in</span> os.listdir():</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true"></a>    <span class="cf">if</span> i.endswith(<span class="st">'lr_liana_consensus_unfiltered.csv'</span>):</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true"></a>        evfull <span class="op">=</span> pd.read_csv(i)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true"></a>        evfull <span class="op">=</span> evfull.loc[:,[<span class="st">'ligand'</span>,<span class="st">'receptor'</span>,<span class="st">'source'</span>,<span class="st">'target'</span>,<span class="st">'lr_means'</span>,<span class="st">'cellphone_pvals'</span>]]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true"></a>        evfull[<span class="st">'type_gene_A'</span>] <span class="op">=</span> <span class="st">'Ligand'</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true"></a>        evfull[<span class="st">'type_gene_B'</span>] <span class="op">=</span> <span class="st">'Receptor'</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true"></a>        evfull[<span class="st">'gene_A'</span>] <span class="op">=</span> evfull[<span class="st">'ligand'</span>]</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true"></a>        evfull[<span class="st">'gene_B'</span>] <span class="op">=</span> evfull[<span class="st">'receptor'</span>]</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true"></a>        evfull[<span class="st">'MeanLR'</span>] <span class="op">=</span> evfull[<span class="st">'lr_means'</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true"></a>        evfull.loc[<span class="bu">list</span>(evfull.cellphone_pvals.to_numpy()<span class="op">&lt;=</span><span class="fl">0.05</span>),:].to_csv(<span class="ss">f'</span><span class="sc">{k}</span><span class="ss">_lr_ready.csv'</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true"></a>        evfull <span class="op">=</span> evfull.loc[:, [<span class="st">'source'</span>, <span class="st">'target'</span>, <span class="st">'type_gene_A'</span>, <span class="st">'type_gene_B'</span>, <span class="st">'gene_A'</span>, <span class="st">'gene_B'</span>, <span class="st">'MeanLR'</span>]]</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true"></a>        k<span class="op">=</span>i[<span class="dv">0</span>:i.find(<span class="st">'_lr_'</span>)]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true"></a>        data[k]<span class="op">=</span>os.path.abspath(<span class="ss">f'</span><span class="sc">{k}</span><span class="ss">_lr_ready.csv'</span>)</span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Vanessa Kloeker, James Shiniti Nagai, Nils Leimkühler, Michael T. Schaub, Rebekka Schneider, Ivan Costa Gesteira.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
