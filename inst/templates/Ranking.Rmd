---
title: "Tables"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
      toc: yes
      toc_depth: 3
      theme: simplex
      self_contained: true
params:
  obj1: "path to obj"

---

```{r message=FALSE, warning=FALSE, echo=FALSE, include=FALSE, echo=FALSE}
require(igraph)
require(dplyr)
require(tibble)
require(tidyr)
require(patchwork)
require(stringr)
require(CrossTalkeR)
require(ggraph)
require(graphlayouts)
require(pals)
require(htmltools)
require(DT)
require(knitr)
require(factoextra)
```


## PCA CCI

```{r fig.align='center',warning=FALSE,echo=FALSE}
path <-params$obj1
out <- c()
out1 <- list()
all_data <- readRDS(path)
for(i in 1:length(names(all_data@pca))){
     curr <- names(all_data@pca)[i]
     if(str_detect(curr, '_x_', negate = FALSE) & !str_detect(curr, '_ggi', negate = FALSE)){
     rmd_title <- paste0(curr,'_tbl')
     rmd_title1 <- paste0(curr,'_pca1')
     knit_expanded1 <- paste0("```{r , echo=FALSE, warning=FALSE,fig.width=8,fig.height=8,fig.align = 'center'}\n\n
     fviz_pca_var(all_data@pca[['",curr,"']],
                    axes = c(1,2),
                    col.var='contrib',
                    gradient.cols = c('#00AFBB', '#E7B800', '#FC4E07'),
                    repel = TRUE)+labs(title='",curr,"')\n

     ```")
     title <- paste0('\n\n## Table PCA CCI ',curr)
     knit_expanded <- paste0("\n\n```{r , results='",rmd_title,"', echo=FALSE, warning=FALSE}\n\n
         pca <- all_data@pca[['",curr,"']]$x[,1:2]
         pca[,1] <- round(pca[,1],6)
         pca[,2] <- round(pca[,2],6)
         ranking <- cbind(all_data@rankings[['",curr,"']][,2:dim(all_data@rankings[['",curr,"']])[2]],pca[all_data@rankings[['",curr,"']]$nodes,])
         datatable(ranking,
                 caption='",curr,"',
                 extensions = 'Buttons',
                 options = list(dom = 'Bfrtip',
                                buttons = c('copy',
                                            'csv',
                                            'excel',
                                            'pdf', 'print'),
                               autoWidth = FALSE
                               )
                )

     ```")
     out <- c(out,knit_expanded1,title,knit_expanded)
     out1[[curr]] <-knit_expanded
   }  
}

```

`r paste(knit(text = out), collapse = '\n')`

## PCA GCI

```{r fig.align='center',warning=FALSE,echo=FALSE}
path <-params$obj1
out <- c()
out1 <- list()
all_data <- readRDS(path)
for(i in 1:length(names(all_data@pca))){
     curr <- names(all_data@pca)[i]
     if(str_detect(curr, '_x_', negate = FALSE) & str_detect(curr, '_ggi', negate = FALSE)){
     rmd_title <- paste0(curr,'_tbl')
     rmd_title1 <- paste0(curr,'_pca')
     knit_expanded1 <- paste0("```{r , echo=FALSE, warning=FALSE,fig.width=8,fig.height=8,fig.align = 'center'}\n\n
     fviz_pca_var(all_data@pca[['",curr,"']],
                    axes = c(1,2),
                    col.var='contrib',
                    gradient.cols = c('#00AFBB', '#E7B800', '#FC4E07'),
                    repel = TRUE)+labs(title='",curr,"')\n

     ```")
     title <- paste0('\n\n## Table PCA CGI ',curr)
     knit_expanded <- paste0("```{r , results='",rmd_title,"', echo=FALSE, warning=FALSE}\n\n
         pca <- all_data@pca[['",curr,"']]$x[,1:2]
         pca[,1] <- round(pca[,1],6)
         pca[,2] <- round(pca[,2],6)
         ranking <- cbind(all_data@rankings[['",curr,"']][,2:dim(all_data@rankings[['",curr,"']])[2]],pca[all_data@rankings[['",curr,"']]$nodes,])
         datatable(ranking,
                 caption='",curr,"',
                 extensions = 'Buttons',
                 options = list(dom = 'Bfrtip',
                                buttons = c('copy',
                                            'csv',
                                            'excel',
                                            'pdf', 'print'),
                               autoWidth = FALSE
                               )
                )

     ```")
     out <- c(out,knit_expanded1,title,knit_expanded)
     out1[[curr]] <-knit_expanded
   }  
}

```
`r paste(knit(text = out), collapse = '\n')`


## PCA GCI barplot

```{r fig.align='center',warning=FALSE,echo=FALSE}
path <-params$obj1
out <- c()
out1 <- list()
all_data <- readRDS(path)
for(i in 1:length(names(all_data@pca))){
     curr <- names(all_data@pca)[i]
     if(str_detect(curr, '_x_', negate = FALSE) & str_detect(curr, '_ggi', negate = FALSE)){
     rmd_title <- paste0(curr,'_tbl')
     rmd_title1 <- paste0(curr,'_pca')
     knit_expanded1 <- paste0("```{r , echo=FALSE, warning=FALSE,fig.width=8,fig.height=8,fig.align = 'center'}\n\n
          plot_pca(all_data@pca[['",curr,"']]$x,all_data@tables[['",substr(curr,1,str_locate(curr,"_ggi")[1]-1),"']],pc=1)
    ```")
    knit_expanded <- paste0("```{r , echo=FALSE, warning=FALSE,fig.width=8,fig.height=8,fig.align = 'center'}\n\n
         plot_pca(all_data@pca[['",curr,"']]$x,all_data@tables[['",substr(curr,1,str_locate(curr,"_ggi")[1]-1),"']] ,pc=2)
   ```")
     out <- c(out,knit_expanded1,knit_expanded)
     out1[[curr]] <-knit_expanded
   }  
}

```
`r paste(knit(text = out), collapse = '\n')`
